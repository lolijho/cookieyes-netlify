(()=>{var e={};e.id=514,e.ids=[514],e.modules={839:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{patchFetch:()=>p,routeModule:()=>u,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var o=s(6559),n=s(8088),a=s(7719),i=s(7575),c=e([i]);i=(c.then?(await c)():c)[0];let u=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/projects/[id]/route",pathname:"/api/projects/[id]",filename:"route",bundlePath:"app/api/projects/[id]/route"},resolvedPagePath:"/Users/cuweb/Desktop/cookiefacile/cookie/app/api/projects/[id]/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:h}=u;function p(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}r()}catch(e){r(e)}})},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4562:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{db:()=>a});var o=s(8855),n=e([o]);o=(n.then?(await n)():n)[0];let a=(0,o.createClient)({url:process.env.STORAGE_TURSO_DATABASE_URL||process.env.TURSO_DATABASE_URL||"file:./local.db",authToken:process.env.STORAGE_TURSO_AUTH_TOKEN||process.env.TURSO_AUTH_TOKEN});r()}catch(e){r(e)}})},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},7575:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{DELETE:()=>p,GET:()=>i,PUT:()=>c});var o=s(2190),n=s(4562),a=e([n]);async function i(e,{params:t}){try{let s=t.id,{searchParams:r}=new URL(e.url),a=r.get("userId");if(!a)return o.NextResponse.json({message:"User ID richiesto"},{status:400});let i=await n.db.execute({sql:`
        SELECT p.*, 
               COUNT(c.id) as total_consents,
               COUNT(CASE WHEN c.created_at > datetime('now', '-7 days') THEN 1 END) as recent_consents
        FROM projects p
        LEFT JOIN consents c ON p.id = c.project_id
        WHERE p.id = ? AND p.user_id = ?
        GROUP BY p.id
      `,args:[s,a]});if(0===i.rows.length)return o.NextResponse.json({message:"Progetto non trovato"},{status:404});let c=await n.db.execute({sql:"SELECT * FROM cookie_categories WHERE project_id = ? ORDER BY created_at ASC",args:[s]}),p=await n.db.execute({sql:"SELECT * FROM tracking_scripts WHERE project_id = ? ORDER BY created_at ASC",args:[s]});return o.NextResponse.json({project:i.rows[0],categories:c.rows,scripts:p.rows})}catch(e){return console.error("Errore nel recupero progetto:",e),o.NextResponse.json({message:"Errore interno del server"},{status:500})}}async function c(e,{params:t}){try{let s=t.id,{userId:r,name:a,domain:i,language:c,bannerPosition:p,bannerTitle:u,bannerDescription:d,bannerAcceptText:l,bannerRejectText:h,bannerCustomizeText:g,bannerBgColor:E,bannerTextColor:_,bannerAcceptBgColor:R,bannerAcceptTextColor:x,bannerRejectBgColor:j,bannerRejectTextColor:v}=await e.json();if(!r)return o.NextResponse.json({message:"User ID richiesto"},{status:400});let m=await n.db.execute({sql:"SELECT id FROM projects WHERE id = ? AND user_id = ?",args:[s,r]});if(0===m.rows.length)return o.NextResponse.json({message:"Progetto non trovato"},{status:404});let w=Math.floor(Date.now()/1e3),T=[],b=[];if(void 0!==a&&(T.push("name = ?"),b.push(a)),void 0!==i&&(T.push("domain = ?"),b.push(i)),void 0!==c&&(T.push("language = ?"),b.push(c)),void 0!==p&&(T.push("banner_position = ?"),b.push(p)),void 0!==u&&(T.push("banner_title = ?"),b.push(u)),void 0!==d&&(T.push("banner_description = ?"),b.push(d)),void 0!==l&&(T.push("banner_accept_text = ?"),b.push(l)),void 0!==h&&(T.push("banner_reject_text = ?"),b.push(h)),void 0!==g&&(T.push("banner_customize_text = ?"),b.push(g)),void 0!==E&&(T.push("banner_bg_color = ?"),b.push(E)),void 0!==_&&(T.push("banner_text_color = ?"),b.push(_)),void 0!==R&&(T.push("banner_accept_bg_color = ?"),b.push(R)),void 0!==x&&(T.push("banner_accept_text_color = ?"),b.push(x)),void 0!==j&&(T.push("banner_reject_bg_color = ?"),b.push(j)),void 0!==v&&(T.push("banner_reject_text_color = ?"),b.push(v)),0===T.length)return o.NextResponse.json({message:"Nessun campo da aggiornare"},{status:400});T.push("updated_at = ?"),b.push(w),b.push(s),await n.db.execute({sql:`UPDATE projects SET ${T.join(", ")} WHERE id = ?`,args:b});let N=await n.db.execute({sql:"SELECT * FROM projects WHERE id = ?",args:[s]});return o.NextResponse.json({message:"Progetto aggiornato con successo",project:N.rows[0]})}catch(e){return console.error("Errore nell'aggiornamento progetto:",e),o.NextResponse.json({message:"Errore interno del server"},{status:500})}}async function p(e,{params:t}){try{let s=t.id,{searchParams:r}=new URL(e.url),a=r.get("userId");if(!a)return o.NextResponse.json({message:"User ID richiesto"},{status:400});let i=await n.db.execute({sql:"SELECT id FROM projects WHERE id = ? AND user_id = ?",args:[s,a]});if(0===i.rows.length)return o.NextResponse.json({message:"Progetto non trovato"},{status:404});return await n.db.execute({sql:"DELETE FROM projects WHERE id = ? AND user_id = ?",args:[s,a]}),o.NextResponse.json({message:"Progetto eliminato con successo"})}catch(e){return console.error("Errore nell'eliminazione progetto:",e),o.NextResponse.json({message:"Errore interno del server"},{status:500})}}n=(a.then?(await a)():a)[0],r()}catch(e){r(e)}})},8335:()=>{},8855:e=>{"use strict";e.exports=import("@libsql/client")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[447,580],()=>s(839));module.exports=r})();